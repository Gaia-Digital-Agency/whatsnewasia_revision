import{r as o,j as e,K as G}from"./chunk-JZWAC4HX-CxGh2Gxx.js";import{M as K}from"./index-Cf1TiTbD.js";import{u as T,g as A}from"./media.service-o8AQdxDz.js";import{C as E}from"./ComponentCard-C_3qlk9J.js";import{B as I}from"./Button--HbAVftr.js";import V from"./MediaForm-BzlJ05xn.js";import{u as X}from"./index-RK8lyzCV.js";import{A as Z}from"./Alert-C0X0X6mW.js";import{u as J}from"./useTimedMessage-DWdBIWEZ.js";import{u as Q}from"./useModal-D_r8d8wF.js";import{B as Y}from"./Badge-2x3-nqzU.js";import{c as ee}from"./createLucideIcon-7IXI4zfk.js";/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],re=ee("image",se),te="http://34.124.244.233",C=12,ae=({onClick:i,onSave:x})=>{const[c,p]=o.useState([]),[n,M]=o.useState(),[f,j]=o.useState(1),[b,m]=o.useState(!0),[$,z]=o.useState(!0),[N,k]=o.useState(!1),[h,u]=o.useState(null),[v,y]=o.useState([]);J(h,u,5e3);const L=10*1024*1024,B=s=>{const r=[];return s.forEach(l=>{l.size>L&&r.push(`${l.name} exceeds 10MB limit (${(l.size/1024/1024).toFixed(2)}MB)`)}),r},_=async s=>{var l,g;if(s.length===0)return;const r=s.map(t=>t.name);try{(await T(s)).data.length&&F();const a=r;y(w=>w.filter(W=>!a.includes(W.name)))}catch(t){console.error("Upload failed",t),t instanceof G?u([((g=(l=t.response)==null?void 0:l.data)==null?void 0:g.message)||"Upload failed"]):u(["Unexpected error occurred"]),y(d=>d.map(a=>({...a,error:"Upload Failed"}))),setTimeout(()=>{y([])},5e3)}},R=o.useCallback((s,r)=>{const l=r.map(a=>{const w=a.errors[0];return w.code==="file-too-large"?`${a.file.name} exceeds 10MB limit.`:`${a.file.name}: ${w.message}`}),g=B(s),t=[...l,...g];if(t.length>0){u(t.join(`
`));return}const d=s.map(a=>Object.assign(a,{id:`${a.name}-${Date.now()}-${Math.random()}`,preview:URL.createObjectURL(a),uploaded:!1,progress:0}));y(a=>[...a,...d]),_(d)},[]),{getRootProps:D,getInputProps:P,isDragActive:S}=X({onDrop:R,noClick:!0,maxSize:L}),F=async()=>{const s=await A({page:1,limit:C});s&&s.data?(p(r=>[...s.data.filter(t=>!r.some(d=>d.id===t.id)).map(t=>({...t})),...r]),m((s==null?void 0:s.hasMore)??!1),j(2),z(!1)):(p([]),m(!1))};o.useEffect(()=>{(async()=>await F())()},[]);const H=async()=>{if(!(N||!b)){k(!0),u(null);try{const s=await A({page:f,limit:C});s&&s.data?(p(r=>[...r,...s.data]),m((s==null?void 0:s.hasMore)??!1),j(r=>r+1)):m(!1)}catch(s){console.error(s,"error wowowowowo"),u("Error loading more media.")}finally{k(!1)}}},O=s=>{M(s),i&&i(s)},q=()=>{n&&x(n)};return $?e.jsx(E,{title:"Media Library",children:e.jsx("div",{className:"flex justify-center items-center h-[500px]",children:e.jsx("p",{children:"Loading media..."})})}):h&&c.length===0?e.jsx(E,{title:"Media Library",children:e.jsx("div",{className:"flex justify-center items-center h-[500px]",children:e.jsx("p",{className:"text-red-500",children:h})})}):c.length===0&&v.length===0?e.jsx(V,{}):e.jsx(e.Fragment,{children:e.jsxs(E,{title:"Media Library",desc:"Select a file from your media gallery, or just drag and drop your image here to upload instantly.",children:[e.jsxs("div",{className:"custom-scrollbar h-110 overflow-y-auto relative",children:[e.jsxs("div",{...D(),children:[e.jsx("input",{...P(),className:"pointer-events-none"}),e.jsx("div",{className:`absolute flex justify-center items-center inset-0 transition border-[10px] border-blue-500 ${S?"opacity-100 text-3xl text-white":"opacity-0"}`,style:{backgroundColor:"rgba(43,127,255,.4)",pointerEvents:"none",zIndex:S?10:0},children:e.jsx("p",{children:"Drop Files here"})}),v.map(s=>e.jsx("div",{className:"inline-flex rounded mb-2 mr-2 w-44 h-44 p-1 box-border transition-all bg-gray-300 relative",children:e.jsxs("div",{className:"flex min-w-0 overflow-hidden items-center justify-center align-middle relative",children:[e.jsx("img",{src:s.preview,alt:s.name||"File being uploaded",className:"block w-auto h-full object-cover opacity-50"}),e.jsx("div",{className:"absolute inset-0 flex flex-col justify-center items-center bg-black bg-opacity-50 text-white",children:s.error?e.jsx("p",{className:"text-red-400 text-center",children:"âŒ Failed"}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("p",{className:"mt-2 text-sm",children:"Uploading..."})]})})]})},s.id)),c.map(s=>{const r=s.id===(n==null?void 0:n.id);return e.jsx("div",{onClick:()=>O(s),className:`inline-flex rounded mb-2 mr-2 w-44 h-44 p-1 box-border cursor-pointer transition-all bg-gray-200 ${r?"border-blue-600 border-4":"border-gray-300 border hover:border-gray-500"}`,children:e.jsx("div",{className:"flex min-w-0 overflow-hidden items-center justify-center align-middle",children:e.jsx("img",{src:`${te}/${s.path}`,alt:s.alt_text||s.filename||"Media asset",className:"block w-auto h-full object-cover hover:scale-110 transition duration-500 ease-in-out"})})},s.id)})]}),e.jsx("div",{className:"flex justify-center mt-4 mb-2",children:b&&e.jsx(I,{onClick:H,disabled:N||v.length>0,variant:"outline",size:"sm",children:N?"Loading...":"Load More"})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t",children:[e.jsx("div",{className:"flex-1",children:h&&e.jsx("div",{className:"mb-0 pr-4",children:e.jsx(Z,{variant:"error",title:"Error",message:h})})}),e.jsx("div",{children:e.jsx(I,{disabled:!n||v.length>0,onClick:q,children:"Select"})})]})]})})},U="http://34.124.244.233",ie=({url:i,alt:x="",ratio:c="16/9"})=>e.jsx("div",{className:"relative overflow-hidden rounded-2xl border border-gray-200 shadow-sm bg-gray-50 group",style:{aspectRatio:c},children:i&&i!=="#"?e.jsx("img",{src:i,alt:x,className:"absolute inset-0 h-full w-full object-cover transition-all duration-300 group-hover:scale-105"}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-400 gap-2",children:[e.jsx("div",{className:"p-3 rounded-full bg-gray-200",children:e.jsx(re,{className:"h-6 w-6 text-gray-400"})}),e.jsx("span",{className:"text-sm font-medium",children:"No Image"})]})}),je=({url:i,alt:x,onSave:c,ratio:p,width:n="100%"})=>{const{isOpen:M,closeModal:f,openModal:j}=Q(!1),b=m=>{f(),c(m)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative group cursor-pointer",style:{width:n},onClick:j,children:[e.jsx(ie,{url:String(i).startsWith(U)?i:U+"/"+i,alt:x,ratio:p,width:n}),e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-all duration-300 backdrop-blur-[2px] rounded-2xl",children:e.jsx(Y,{size:"md",children:"Edit"})})]}),e.jsx(K,{className:"mx-8 lg:mx-32 p-6 lg:p-10",isOpen:M,onClose:f,children:e.jsx(ae,{onSave:b})})]})};export{je as A,ae as M};
