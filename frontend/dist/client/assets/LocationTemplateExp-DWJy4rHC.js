import{r as o,D as $,d as G,j as t,b as U}from"./chunk-JZWAC4HX-DGixXWWH.js";import{g as J,e as L,c as q}from"./template.service-B7okUSdY.js";import{S as z}from"./react-select.esm-BSq895BO.js";import{H as C,A as K,a as Q,b as W,c as X,d as Y}from"./Trending-yjHWRzh3.js";import{C as v}from"./ComponentCard-GFTzXSMy.js";import{u as Z}from"./SidebarContext-CYyr_xfD.js";import{b as V}from"./article.service-Cf6EYyU8.js";import{u as _}from"./NotificationContext-Bm_P1CXC.js";import{u as ee}from"./useModal-Dx3ZjLOW.js";import{M as te}from"./index-BwXtifl2.js";import{D as se,C as re,P as ie}from"./dnd.esm-BWh7f46j.js";import{B as w}from"./Button-DrUF433q.js";import{S as ne}from"./trash-B9AZN_4o.js";import{u as ae}from"./useNavigationPrompt-BzwSU0f9.js";import"./createSuper-D4rtGzd-.js";import"./Button-CjL-dzwU.js";import"./index-BkoRSW3W.js";import"./useArticle-CHSnUTrj.js";import"./Image-B38Khij9.js";import"./navigation-BdfLAnRc.js";import"./create-element-if-not-defined-BY4OuRJn.js";import"./TextLink-DmECMqSD.js";import"./pagination-bkL1SpIs.js";import"./Newsletter-BWtPjMOU.js";import"./newsletter.service-BGFLEjjE.js";import"./format-D2eluCP0.js";import"./Advertisement-Cq0Qawx2.js";import"./Helmet-CI0xc-Sp.js";const oe=(r,l,d)=>{const n=Array.from(r),[c]=n.splice(l,1);return n.splice(d,0,c),n},D=8,ce=(r,l)=>({padding:D*2,margin:`0 0 ${D}px 0`,background:r?"lightgreen":"#f1f1f1",...l}),le=r=>({background:r?"lightblue":"white",padding:D,width:800}),de=({modalKey:r,onSave:l,preContent:d})=>{const[n,c]=o.useState([]),[y,S]=o.useState([]),[g,f]=o.useState([]),[E]=$(),{setNotification:x}=_(),{adminTaxonomies:b,taxonomies:T}=U(),h=E.get("url");if(!h){x({message:"url is not set",type:"fail"});return}const j=e=>{if(!e.destination)return;const s=oe(n,e.source.index,e.destination.index);c(s)};o.useEffect(()=>{const e=h==null?void 0:h.split("/").filter(Boolean);(async()=>{var i,a,A,u,N,O,M,B;const s=await V({id_country:((a=(i=b.countries)==null?void 0:i.find(p=>p.slug==e[0]))==null?void 0:a.id)??void 0,id_city:((u=(A=b.cities)==null?void 0:A.find(p=>p.slug==e[1]))==null?void 0:u.id)??void 0,id_region:((O=(N=b.regions)==null?void 0:N.find(p=>p.slug==e[1]))==null?void 0:O.id)??void 0,category:((B=(M=T.categories)==null?void 0:M.find(p=>{var R,F;return((F=(R=C[r].query)==null?void 0:R.category)==null?void 0:F.slug)==p.slug_title}))==null?void 0:B.id)??void 0});s!=null&&s.articles?S(s.articles):x({message:"something is wrong, cannot get the articles from server",type:"fail"})})()},[]);const H=(e,s)=>{c(()=>[...n].map(a=>a===0||(a==null?void 0:a.id)==e?0:a)),f(()=>{const i=[...g];return i[s]=0,i})},m=(e,s)=>{const i=()=>{if(e)return t.jsxs("div",{className:"flex justify-between",children:[t.jsx("div",{className:"title",children:t.jsx("p",{children:e.title})}),t.jsx("div",{className:"icon",onClick:()=>{H(e.id,s)},children:t.jsx(ne,{})})]})},a=()=>t.jsx("div",{className:"flex",children:t.jsx("p",{children:"Select an article to fill here"})}),A=()=>e?i():a();return t.jsx(t.Fragment,{children:t.jsx(ie,{draggableId:`draggable-${s}`,index:s,children:(u,N)=>t.jsx("div",{ref:u.innerRef,...u.draggableProps,...u.dragHandleProps,style:{...ce(N.isDragging,u.draggableProps.style??{}),marginBottom:"1rem",backgroundColor:e?"rgb(241, 241, 241)":"transparent",border:e?"":"2px dashed #000"},children:A()})},`draggable-${s}`)})},P=()=>{l(n,r)};o.useEffect(()=>{c([]),f([]),d.forEach((e,s)=>{c(i=>[...i,e]),f(i=>[...i,m(e,s)])})},[]),o.useEffect(()=>{n.length&&f(()=>{const e=[];return n.forEach((s,i)=>{e.push(m(s,i))}),e})},[n]);const k=e=>{console.log(e),c(()=>{const s=[...n],i=n.findIndex(a=>a==0);return i>-1&&(s[i]=e),s})},I=e=>{if(e){if(!n.filter(s=>s==0).length){x({message:"Remove one of the selected article first before selecting",type:"fail"});return}k(e)}};if(g.length)return t.jsx(t.Fragment,{children:t.jsx(v,{title:r,children:t.jsxs("div",{className:"grid grid-cols-12",children:[t.jsxs("div",{className:"col-span-6",children:[t.jsx(se,{onDragEnd:j,children:t.jsx(re,{droppableId:"droppable",children:(e,s)=>t.jsx("div",{...e.droppableProps,ref:e.innerRef,style:le(s.isDraggingOver),children:g})})}),t.jsx(w,{onClick:P,children:"Save"})]}),t.jsx("div",{className:"col-span-6",children:t.jsx(z,{options:y.map(e=>({value:e,label:e.title})),styles:{menu:()=>({position:"relative"})},menuIsOpen:!0,onChange:e=>{I(e==null?void 0:e.value)},value:void 0})})]})})})},_e=()=>{const[r,l]=o.useState(C),d=o.useRef(!1),[n,c]=o.useState(!1),[y,S]=o.useState(!1),[g]=$(),f=G(),{isOpen:E,closeModal:x,openModal:b}=ee(!0),{closeSidebar:T}=Z(),{setBlock:h}=ae(),{setNotification:j}=_();o.useEffect(()=>{T(),(async()=>{var i;const e=g.get("url");if(!e){f("/admin/mst_templates");return}const s=await J(`/v2${e}`);(s==null?void 0:s.status_code)==200&&((i=s.data)!=null&&i.content)?(l(JSON.parse(s.data.content)),d.current=!0):(l(C),d.current=!1)})()},[]),o.useEffect(()=>{h(y)},[y]);const H=(e,s)=>{l(i=>({...i,[s]:{...i[s],articles:e}})),S(!0),c(!1),x()},m=e=>{c(e),b()},P=()=>{c(!1),x()};console.log(r==null?void 0:r.ultimateGuide.articles,"trending");const k=()=>n?t.jsx(te,{isOpen:E,onClose:P,children:t.jsx(de,{modalKey:n,onSave:H,preContent:r==null?void 0:r[n].articles})}):t.jsx(t.Fragment,{}),I=async()=>{const e=g.get("url");if(d.current&&e){const s=await L(`/v2${e}`,"Home",JSON.stringify(r));j(s?{message:"Action Success",type:"neutral"}:{message:"Action Failed",type:"fail"})}if(!d.current&&e){const s=await q(`/v2${e}`,"Home",JSON.stringify(r));j(s?{message:"Action Success",type:"neutral"}:{message:"Action Failed",type:"fail"})}S(!1)};return t.jsxs(t.Fragment,{children:[t.jsx(w,{onClick:I,children:"Save Template"}),t.jsx("div",{className:"spacer py-6"}),t.jsx(v,{title:"Hero Image",buttonText:"Edit Articles",buttonOnClick:()=>{m("heroImage")},children:t.jsx(K,{preContent:r==null?void 0:r.heroImage.articles})}),t.jsx("div",{className:"spacer py-6"}),t.jsx(v,{title:"Trending",buttonText:"Edit Articles",buttonOnClick:()=>{m("trending")},children:t.jsx(Q,{preContent:r==null?void 0:r.trending.articles})}),t.jsx("div",{className:"spacer py-6"}),t.jsx(v,{title:"Most Popular",buttonText:"Edit Articles",buttonOnClick:()=>{m("mostPopular")},children:t.jsx(W,{preContent:r==null?void 0:r.mostPopular.articles})}),t.jsx("div",{className:"spacer py-6"}),t.jsx(v,{title:"Events",buttonText:"Edit Articles",buttonOnClick:()=>{m("events")},children:t.jsx(X,{preContent:r==null?void 0:r.events.articles})}),t.jsx("div",{className:"spacer py-6"}),t.jsx(v,{title:"Ultimate Guide",buttonText:"Edit Articles",buttonOnClick:()=>{m("ultimateGuide")},children:t.jsx(Y,{preContent:r==null?void 0:r.ultimateGuide.articles})}),t.jsx("div",{className:"spacer py-6"}),k()]})};export{_e as default};
