import{r as v,p as E,j as e,b as w}from"./chunk-JZWAC4HX-DGixXWWH.js";import{g as D,e as M,c as _}from"./template.service-B7okUSdY.js";import{B as k}from"./Button-DrUF433q.js";import{u as B}from"./useNavigationPrompt-BzwSU0f9.js";import{C as S}from"./ComponentCard-GFTzXSMy.js";import{S as O}from"./trash-B9AZN_4o.js";import{D as R,C as I,P as L}from"./dnd.esm-BWh7f46j.js";import{u as $}from"./NotificationContext-Bm_P1CXC.js";import{S as J}from"./react-select.esm-BSq895BO.js";import"./createSuper-D4rtGzd-.js";const U=n=>{if(!n)return;const s=new Map,c=[];for(const t of n)s.set(t.id,{label:t.title,value:t.id,children:[]});for(const t of n){const o=s.get(t.id);if(t.id_parent===0||t.id_parent===null)c.push(o);else{const m=s.get(t.id_parent);m&&m.children.push(o)}}return c.map(t=>t.children.length>0?{label:t.label,options:[{label:t.label,value:t.value,level:0},...t.children.map(o=>({label:o.label,value:o.value,level:1}))]}:{label:t.label,value:t.value,level:0})},F=({id:n,menu:s,onChange:c,onDelete:t})=>{var x,g,u,h;const{taxonomies:o}=w(),m=(i,p)=>{p&&c(n,i,p)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"menu-edit flex items-center",children:[e.jsx("div",{className:"input-wrapper",children:e.jsx(J,{className:"w-100",required:!0,options:U(o.categories),placeholder:"Select Category",value:{value:s.linkCategory,label:(g=(x=o.categories)==null?void 0:x.find(i=>i.id==s.linkCategory))==null?void 0:g.title,level:(h=(u=o.categories)==null?void 0:u.find(i=>i.id==s.linkCategory))!=null&&h.id_parent?1:0},onChange:i=>{m("linkCategory",i==null?void 0:i.value)},classNames:{option:i=>{var p;return((p=i.data)==null?void 0:p.level)==1?"text-front-small ml-2 before-dash":""}}})}),e.jsx("div",{className:"input-wrapper",children:e.jsx("div",{className:"icon-delete pl-4",children:e.jsx("div",{onClick:()=>{t(n)},className:"delete cursor-pointer w-[32px] h-[32px] flex justify-center items-center border border-black rounded-full",children:e.jsx(O,{className:""})})})})]})})},q=(n,s,c)=>{const t=Array.from(n),[o]=t.splice(s,1);return t.splice(c,0,o),t},y=8,G=(n,s)=>({padding:y*2,margin:`0 0 ${y}px 0`,background:n?"lightgreen":"#f1f1f1",...s}),Y=n=>({background:n?"lightblue":"white",padding:y,width:800}),re=()=>{const{setNotification:n}=$(),[s,c]=v.useState([]),[t,o]=v.useState(!1),[m,x]=v.useState([]),{setBlock:g}=B(),u="/header",h="Header",i={label:"",url:"",linkCategory:0};v.useEffect(()=>{(async()=>{var a;try{const r=await D(u);if((a=r==null?void 0:r.data)!=null&&a.content&&r.status_code==200){let d=[];const l=JSON.parse(r.data.content);Object.keys(l).forEach(f=>{var j,C,N;const b=f;d.push({label:(j=l[b])==null?void 0:j.label,url:(C=l[b])==null?void 0:C.url,linkCategory:(N=l[b])==null?void 0:N.linkCategory})}),c(d),o(!0)}else c([i])}catch(r){console.log(r)}try{const r=await E();r.data&&x(r.data.map(d=>({value:d.id,label:d.title})))}catch(r){console.log(r)}})()},[]);const p=(a,r,d)=>{const l=[...s];l[a]={...l[a],[r]:d},r=="linkCategory"&&(l[a]={...l[a],url:""}),c(l),g(!0)},T=a=>{const r=[...s].filter((d,l)=>{if(console.log(a),l!=a)return d});c(r)},H=async()=>{t?await M(u,h,JSON.stringify(s))?(n({message:"Header menu saved",type:"neutral"}),g(!1)):n({message:"cant save the changes",type:"fail"}):await _(u,h,JSON.stringify(s))&&(n({message:"Success save header menu",type:"neutral"}),o(!0),g(!1))},P=()=>{c(a=>[...a,i]),g(!0)},A=a=>{if(console.log(a),!a.destination)return;const r=q(s,a.source.index,a.destination.index);console.log(r),c(r)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-12 gap-x-4",children:[e.jsx("div",{className:"col-span-10",children:e.jsxs(S,{title:"Header Navigation",children:[e.jsx(R,{onDragEnd:A,children:e.jsx(I,{droppableId:"droppable",children:(a,r)=>e.jsx("div",{...a.droppableProps,ref:a.innerRef,style:Y(r.isDraggingOver),children:s.map((d,l)=>{if(d)return e.jsx(L,{draggableId:`draggable-${l}`,index:l,children:(f,b)=>e.jsx("div",{ref:f.innerRef,...f.draggableProps,...f.dragHandleProps,style:{...G(b.isDragging,f.draggableProps.style??{}),marginBottom:"1rem"},children:e.jsx(F,{id:l,menu:d,onDelete:T,onChange:p,availableCategories:m})})},`draggable-${l}`)})})})}),e.jsx(k,{onClick:P,children:"Add Menu"})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx(S,{children:e.jsx("div",{className:"text-center",children:e.jsx(k,{onClick:H,children:"Save"})})})})]})})};export{re as default};
