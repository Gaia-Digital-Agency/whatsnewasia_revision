import{r as h,F as V,j as e,C as X,e as Y,D as ee,u as te,d as se,p as ae,z as re,G as Z,L as ie}from"./chunk-JZWAC4HX-DGixXWWH.js";import{b as $,d as ne}from"./article.service-Cf6EYyU8.js";import{B as le}from"./Button-DrUF433q.js";import{S as ce}from"./Select-BCgLQIBa.js";import{g as S}from"./pagination-DPKfsKWo.js";const F=({children:s})=>e.jsx(e.Fragment,{children:s}),oe=({children:s,onClick:a})=>{const[c,g]=h.useState(0),w=["pl-0","pl-2","pl-4"],m=V.Children.toArray(s).filter(l=>V.isValidElement(l));return e.jsx("div",{className:"p-6 border border-gray-200 rounded-xl dark:border-gray-800",children:e.jsxs("div",{className:"flex flex-col gap-6 sm:flex-row sm:gap-8",children:[e.jsx("div",{className:"overflow-x-auto pb-2 sm:w-[200px] [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:bg-gray-100 dark:[&::-webkit-scrollbar-thumb]:bg-gray-600 [&::-webkit-scrollbar-track]:bg-white dark:[&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar]:h-1.5",children:e.jsx("nav",{className:"flex flex-row w-full sm:flex-col sm:space-y-2",children:m.map((l,y)=>e.jsx("div",{className:`w-full block ${w[l.props.level??0]}`,children:e.jsx("button",{className:`inline-flex w-full items-center rounded-lg px-3 py-2 text-sm font-medium transition-colors duration-200 ease-in-out sm:p-3 ${c===y?"text-brand-500 dark:bg-brand-400/20 dark:text-brand-400 bg-brand-50":"bg-transparent text-gray-500 border-transparent hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,onClick:()=>{g(y),a()},children:l.props.title})},`vertical-tab-${y}`))})}),e.jsx("div",{className:"flex-1",children:m[c]})]})})},de=({page:s,onClick:a,currentPage:c})=>e.jsx("div",{className:`px-4 py-2 font-medium ${typeof s=="string"?"":"cursor-pointer"} ${c==s?"text-front-red":""}`,onClick:()=>{typeof s=="string"||typeof s=="object"||a(s)},children:s}),B=({page:s,currentPage:a,onClick:c})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"prev-button cursor-pointer",onClick:()=>{c(a-1)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"12",viewBox:"0 0 8 12",fill:"none",style:{rotate:"180deg"},children:e.jsx("path",{d:"M0.589844 10.59L5.16984 6L0.589844 1.41L1.99984 0L7.99984 6L1.99984 12L0.589844 10.59Z",fill:"black"})})}),typeof s=="object"&&s.map(g=>e.jsx(de,{page:g,currentPage:a,onClick:c})),e.jsx("div",{className:"next-button cursor-pointer",onClick:()=>{c(a+1)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"12",viewBox:"0 0 8 12",fill:"none",children:e.jsx("path",{d:"M0.589844 10.59L5.16984 6L0.589844 1.41L1.99984 0L7.99984 6L1.99984 12L0.589844 10.59Z",fill:"black"})})})]}),D=({article:s,onClick:a,category:c})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"article-post p-6 shadow rounded flex justify-between items-center",children:[e.jsxs("div",{className:"inner",children:[e.jsx("div",{className:"title-wrap",children:e.jsx("p",{className:"text-xl",children:s.title})}),e.jsx("div",{className:"attr-wrap",children:e.jsxs("p",{className:"text-md",children:[s.name_country," / ",s==null?void 0:s.name_city," / ",s==null?void 0:s.name_region," - ",e.jsx("span",{className:"text-sm text-front-gray",children:s.status})]})}),c&&e.jsx("div",{className:"category-wrap",children:e.jsx("p",{className:"text-md text-front-red",children:c.title})})]}),e.jsxs("div",{className:"action flex items-center gap-x-4",children:[e.jsx(le,{className:"bg-red-600",onClick:a,children:"Remove"}),e.jsx(ie,{className:"px-5 py-3.5 text-sm inline-flex items-center justify-center gap-2 rounded-lg transition bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300",to:`/admin/mst_article/edit/${s.id}`,children:"Edit"})]})]})}),he=()=>{const{setPageAdminButtonText:s}=X(),[a,c]=h.useState(),[g,w]=h.useState([]),{country:m}=Y(),[l,y]=h.useState(),[k,v]=ee(),{userDetails:f}=te(),z=se(),E=k.get("page"),x=E?parseInt(E):1,P=25;h.useEffect(()=>{if(s("Add Article"),!m)return;const t=k.get("category");let r;t&&(r=typeof t=="string"?parseInt(t):t),(async()=>{var i;try{const n=await re("country",parseInt(m));if(n.status_code!==200||!n.data)return;const o=n.data,d=await $({id_country:parseInt(m),status:["draft","published"],category:r,page:x,limit:P});d!=null&&d.articles?c({id:o.id,name:o.name,slug:o.slug,articles:d.articles,totalPages:(i=d.pagination)==null?void 0:i.totalPages}):c({id:o.id,name:o.name,slug:o.slug,articles:[]});const p=await Z("city",parseInt(m));if(p.status_code!==200||!p.data)return;const I=p.data.map(async N=>{var H;const K=Z("region",N.id),Q=$({id_city:N.id,id_country:parseInt(m),status:["draft","published"],category:r,limit:P,page:x}),[A,j]=await Promise.all([K,Q]);let T=[];if(A.status_code===200&&A.data){const U=A.data.map(async M=>{var R;const b=await $({id_city:N.id,id_region:M.id,id_country:parseInt(m),status:["draft","published"],category:r,limit:P,page:x});return{...M,articles:(b==null?void 0:b.articles)||[],totalPages:(R=b==null?void 0:b.pagination)==null?void 0:R.totalPages}});T=await Promise.all(U)}return{...N,articles:(j==null?void 0:j.articles)||[],totalPages:(H=j==null?void 0:j.pagination)==null?void 0:H.totalPages,child:T}}),J=await Promise.all(I);w(J)}catch(n){console.log(n)}})()},[m,k]),h.useEffect(()=>{if(f){if(f.user_level=="super_admin")return;f.id_country&&`${f.id_country}`!==m&&z(`/admin/mst_article/${f.id_country}`)}},[f]),h.useEffect(()=>{(async()=>{try{const t=await ae();t.data&&y(t.data)}catch(t){console.log(t)}})()},[]);const G=()=>{v("page=")},_=async t=>{try{if(await ne(t)){const u=[...g];w(u.map(i=>{var o,d;const n=(o=i.child)==null?void 0:o.map(p=>{var L;return{...p,articles:(L=p.articles)==null?void 0:L.filter(I=>I.id!=t)}});return{...i,articles:(d=i.articles)==null?void 0:d.filter(p=>p.id!=t),child:n}})),c(i=>{var n;if(i)return{...i,articles:(n=i.articles)==null?void 0:n.filter(o=>o.id!=t)}})}}catch(r){console.log(r)}},C=t=>{v(`page=${t}`)},O=()=>g.reduce((t,r)=>{var u;if(t.push(e.jsxs(F,{level:1,title:r.name,children:[(u=r.articles)==null?void 0:u.map(i=>e.jsx(D,{onClick:()=>{_(i.id)},article:i,category:l==null?void 0:l.filter(n=>n.id==i.category_id)[0]},i.id)),e.jsx("div",{className:"pagination-wrapper flex justify-center gap-x-4 py-8 items-center",children:e.jsx(B,{page:S(x,r.totalPages),currentPage:x,onClick:C})})]},r.id)),r.child){const i=r.child.map(n=>{var o;return e.jsxs(F,{level:2,title:n.name,children:[(o=n.articles)==null?void 0:o.map(d=>e.jsx(D,{onClick:()=>{_(d.id)},article:d,category:l==null?void 0:l.filter(p=>p.id==d.category_id)[0]},d.id)),e.jsx("div",{className:"pagination-wrapper flex justify-center gap-x-4 py-8 items-center",children:e.jsx(B,{page:S(x,n.totalPages),currentPage:x,onClick:C})})]},`${r.id}-${n.id}`)});t.push(...i)}return t},[]),W=t=>{v(t?`?category=${t}`:"")},q=()=>{var t;return a!=null&&a.articles?e.jsxs(e.Fragment,{children:[(t=a==null?void 0:a.articles)==null?void 0:t.map(r=>e.jsx(D,{onClick:()=>{_(r.id)},article:r,category:l==null?void 0:l.filter(u=>u.id==r.category_id)[0]})),e.jsx("div",{className:"pagination-wrapper flex justify-center gap-x-4 py-8 items-center",children:e.jsx(B,{page:S(x,a.totalPages),currentPage:x,onClick:C})})]}):e.jsx("p",{children:"No article Found"})};return g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-12",children:e.jsx("div",{className:"col-span-4",children:e.jsx("div",{className:"category-select",children:l&&e.jsx(ce,{placeholder:"Select a Category",options:l.map(t=>({label:t.title,value:t.id})),onChange:W})})})}),e.jsxs(oe,{onClick:G,children:[e.jsx(F,{level:0,title:(a==null?void 0:a.name)??"",children:q()}),...O()]})]}):e.jsx(e.Fragment,{})};export{he as default};
