import{h as U,b as V,r as c,D as Y,$ as Z,a0 as G,j as e,L as O}from"./chunk-JZWAC4HX-DGixXWWH.js";import{b as z}from"./article.service-Cf6EYyU8.js";import{I as q}from"./Image-B38Khij9.js";import{f as J}from"./format-D2eluCP0.js";import{g as K}from"./pagination-DPKfsKWo.js";import{A as Q}from"./Advertisement-Cq0Qawx2.js";import{N as R}from"./Newsletter-BWtPjMOU.js";import{u as X}from"./useArticle-CHSnUTrj.js";import{D as ee}from"./index-BaIO-gc9.js";import{p as te}from"./Helmet-CI0xc-Sp.js";import"./index-BkoRSW3W.js";import"./Button-CjL-dzwU.js";import"./newsletter.service-BGFLEjjE.js";import"./NotificationContext-Bm_P1CXC.js";import"./useCustomizedInput-BGlvDKG2.js";import"./createSuper-D4rtGzd-.js";import"./index-DyEGC2D2.js";import"./index-BzkAr_FG.js";const{Helmet:se}=te,ne=({page:t,onClick:n,currentPage:r})=>e.jsx("div",{className:`px-4 py-2 font-medium ${typeof t=="string"?"":"cursor-pointer"} ${r==t?"text-front-red":""}`,onClick:()=>{typeof t=="string"||typeof t=="object"||n(t)},children:t}),re=({page:t,currentPage:n,onClick:r})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"prev-button cursor-pointer",onClick:()=>{r(n-1)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"12",viewBox:"0 0 8 12",fill:"none",style:{rotate:"180deg"},children:e.jsx("path",{d:"M0.589844 10.59L5.16984 6L0.589844 1.41L1.99984 0L7.99984 6L1.99984 12L0.589844 10.59Z",fill:"black"})})}),typeof t=="object"&&t.map(a=>e.jsx(ne,{page:a,currentPage:n,onClick:r})),e.jsx("div",{className:"next-button cursor-pointer",onClick:()=>{r(n+1)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"12",viewBox:"0 0 8 12",fill:"none",children:e.jsx("path",{d:"M0.589844 10.59L5.16984 6L0.589844 1.41L1.99984 0L7.99984 6L1.99984 12L0.589844 10.59Z",fill:"black"})})})]}),ie=({article:t,tag:n})=>{const{getPermalink:r,getFeaturedImageUrl:a}=X();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"image-wrapper mb-5",children:e.jsx(q,{url:a(t),ratio:"100%",link:r(t)})}),t.tags&&e.jsx("div",{className:"tag-wrapper mb-2 text-front-red",children:n==null?void 0:n.name}),e.jsx("div",{className:"title-wrapper mb-2",children:e.jsx(O,{to:r(t),children:e.jsx("p",{className:"text-front-subtitle font-serif",children:t.title})})}),e.jsx("div",{className:"subtitle-wrapper mb-5",children:e.jsx("p",{className:"text-front-small text-front-soft-grey leading-normal",children:t.sub_title})}),e.jsxs("div",{className:"date-wrapper flex gap-x-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",children:[e.jsx("path",{d:"M1.125 4.14229C1.125 3.17103 1.91236 2.38367 2.88362 2.38367H12.1164C13.0877 2.38367 13.875 3.17103 13.875 4.14229V11.6164C13.875 12.5877 13.0877 13.375 12.1164 13.375H2.88362C1.91236 13.375 1.125 12.5877 1.125 11.6164V4.14229Z",stroke:"#7F7F7F","stroke-width":"0.9","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M3.98267 0.624878V3.70246",stroke:"#7F7F7F",strokeWidth:"0.9",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11.0173 0.624878V3.70246",stroke:"#7F7F7F",strokeWidth:"0.9",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M3.76294 5.90027H11.2371",stroke:"#7F7F7F",strokeWidth:"0.9",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("p",{className:"text-front-small text-[#A9A9A9]",children:J(t.updatedAt)})]})]})},x=t=>t.toISOString().split("T")[0],ae=t=>{const n=new Date(t),r=n.getDay()||7,a=new Date(n),f=new Date(n);return a.setDate(n.getDate()-(r-1)),f.setDate(n.getDate()+(7-r)),[x(a),x(f)]},oe=t=>{const n=new Date(t),r=new Date(n.getFullYear(),n.getMonth(),1),a=new Date(n.getFullYear(),n.getMonth()+1,0);return[x(r),x(a)]},de=(t,n)=>{if(!t||!n)return null;const r=new Date(n);let a=[null,null];return t=="today"&&(a[0]=x(r),a[1]=x(r)),t=="week"&&(a=ae(n)),t=="month"&&(a=oe(n)),typeof t=="object"&&(a[0]=t[0],a[1]=t[1]??null),a},le=({articles:t,tags:n})=>t!=null&&t.length?e.jsx(e.Fragment,{children:t==null?void 0:t.map((r,a)=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"md:col-span-4 col-span-12",children:e.jsx(ie,{article:r,index:a,tag:n==null?void 0:n.find(f=>f.id==(r!=null&&r.tags?r.tags[0]:0))})})}))}):e.jsx(e.Fragment,{children:"Article not found"}),Le=()=>{var D;const{actualRoute:t}=U(),{taxonomies:n}=V(),[r,a]=c.useState(),[f,P]=c.useState(),[S,A]=c.useState(),[m,h]=Y(),[p,T]=c.useState(),[u,b]=c.useState(1),[B,w]=c.useState(),{initialData:C}=Z(),M="deals",d=(D=n==null?void 0:n.categories)==null?void 0:D.find(s=>s.slug_title==M),$=c.useRef(null),v=m.get("page"),j=v?parseInt(v):1,y=m.get("subcategory"),k=y?parseInt(y):d==null?void 0:d.id,g=m.get("date"),W=g?(g==null?void 0:g.split(",").length)>1?g.split(","):g:null;c.useEffect(()=>{(async()=>{var l,F,_,L;const s={metaData_start_date:null,metaData_end_date:null},i=de(W,C);i&&i[0]&&(s.metaData_start_date=i[0]),i&&i[1]&&(s.metaData_end_date=i[1]),s.metaData_start_date||delete s.metaData_start_date,s.metaData_end_date||delete s.metaData_end_date;const o=await z({id_country:((l=t==null?void 0:t.country)==null?void 0:l.id)??void 0,id_city:((F=t==null?void 0:t.city)==null?void 0:F.id)??void 0,id_region:((_=t==null?void 0:t.region)==null?void 0:_.id)??void 0,category:k,limit:9,page:j,...s});o!=null&&o.articles?(a(o.articles),b(((L=o.pagination)==null?void 0:L.totalPages)??1)):(a([]),b(1))})()},[m,t]),c.useEffect(()=>{var s,i;window.scrollTo(0,0),(i=(s=t.category)==null?void 0:s.tags)!=null&&i.length?w(t.category.tags):w([])},[t]),c.useEffect(()=>{(async()=>{var i,o,l;if(!d)return;const s=await G(d==null?void 0:d.id,{id_country:(i=t==null?void 0:t.country)==null?void 0:i.id,id_city:(o=t==null?void 0:t.city)==null?void 0:o.id,id_region:(l=t==null?void 0:t.region)==null?void 0:l.id});s&&(P(s.sub_title),A(s.description))})()},[t]),c.useEffect(()=>{var s;T((s=n.categories)==null?void 0:s.filter(i=>{var o;return i.id_parent==((o=t==null?void 0:t.category)==null?void 0:o.id)})),window.scrollTo(0,0)},[]);const N=s=>{s>u||s<=0||h(`subcategory=${s}`)},E=()=>{if(!(!(p!=null&&p.length)||!p))return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex mb-10 border-b border-b-[#BDBDBD]",children:[e.jsx("div",{onClick:()=>{N(0)},className:`px-5 py-3 cursor-pointer text-front-small ${k==(d==null?void 0:d.id)?"is-active text-front-red":"text-[#4B4B4B]"}`,children:d==null?void 0:d.title}),p==null?void 0:p.map(s=>e.jsx("div",{onClick:()=>{N(s.id)},className:`px-5 py-3 cursor-pointer text-front-small ${`${s.id}`==m.get("subcategory")?"is-active text-front-red":"text-[#4B4B4B]"}`,children:s.title}))]})})},H=s=>{s>u||s<=0||h(`page=${s}`)},I=()=>{const s=i=>{if(m.get("date")==i||!i){h(o=>{const l=new URLSearchParams(o);return l.delete("date"),l});return}h(o=>{const l=new URLSearchParams(o);return l.set("date",i),l})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex mb-8 gap-x-6",children:[e.jsx("div",{className:`button-date text-front-small px-5 py-2 rounded-full cursor-pointer ${m.get("date")=="today"?"text-[#4b4b4b] bg-[#efefef]":"text-[#959595] bg-[#f5f5f5]"}`,onClick:()=>{s("today")},children:"Today"}),e.jsx("div",{className:`button-date text-front-small px-5 py-2 rounded-full cursor-pointer ${m.get("date")=="week"?"text-[#4b4b4b] bg-[#efefef]":"text-[#959595] bg-[#f5f5f5]"}`,onClick:()=>{s("week")},children:"This Week"}),e.jsx("div",{className:`button-date text-front-small px-5 py-2 rounded-full cursor-pointer ${m.get("date")=="month"?"text-[#4b4b4b] bg-[#efefef]":"text-[#959595] bg-[#f5f5f5]"}`,onClick:()=>{s("month")},children:"This Month"}),e.jsx("div",{className:"button-date text-front-small cursor-pointer",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"text-wrapper rounded-l-full py-2 px-4 text-[#4b4b4b] bg-[#efefef]",children:"Select Date"}),e.jsx(ee,{"aria-setsize":20,className:"deals-date-range",format:"yyyy/MM/dd",onChange:i=>{s(i==null?void 0:i.map(o=>x(new Date(o))).join(","))}})]})})]})})};return e.jsxs(e.Fragment,{children:[e.jsxs(se,{children:[e.jsx("title",{children:"Deals - Whatsnew Asia"}),e.jsx("meta",{name:"description",content:"Whats's New Asia is the ultimate city guide for expats and travelers, featuring the best dining, events, schools, wellness, and travel in Asia"})]}),e.jsxs("section",{className:"py-12",children:[e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"ads-wrapper mb-12",children:e.jsx(Q,{})}),e.jsx("div",{className:"grid grid-cols-12 mb-12",children:e.jsxs("div",{className:"md:col-span-10 md:col-start-2 col-span-12",children:[e.jsx("div",{className:"title-wrapper text-center mb-4",children:e.jsx("p",{className:"font-serif text-front-hero",children:f})}),e.jsx("div",{className:"description-wrapper text-center",children:e.jsx("p",{className:"",children:S})})]})}),E(),I(),e.jsx("div",{className:"grid grid-cols-12 gap-5",ref:$,children:e.jsx(le,{articles:r,tags:B})}),e.jsx("div",{className:"pagination-wrapper flex justify-center gap-x-4 py-8 items-center",children:e.jsx(re,{page:K(j,u),currentPage:j,onClick:H})})]}),e.jsx("div",{className:"newsletter-wrapper bg-front-section-grey py-8 mt-6",children:e.jsx(R,{})})]})]})};export{Le as default};
