import{r as s,b as V,j as e,x as fe,y as ve,z as be,B as Ne}from"./chunk-JZWAC4HX-CJhxn-1v.js";import{P as Se}from"./PageBreadCrumb-BeeDKLN3.js";import{P as Te}from"./PageMeta-BV4yoibv.js";import{C as ee}from"./ComponentCard-C4EWCTcj.js";import{I as Y}from"./InputField-BzPVlfav.js";import{L as j}from"./Label-DAhUyyCs.js";import{B}from"./Button-BSlodQCJ.js";import{A as X}from"./Alert-D2eRQLh0.js";import{S as Le}from"./download-DpAzEKLt.js";import{u as Z}from"./useTimedMessage-BKP6J-G3.js";import{S as z}from"./Select-CAqBW0Os.js";import{t as q}from"./slugify-BCf0ZNXp.js";import{u as G}from"./useModal-BNmD4s86.js";import{B as ke}from"./Badge-291kYT_H.js";import{M as we,g as De}from"./ModalTimezoneTable-Dw4wCXWB.js";import{u as Ce}from"./useNavigationPrompt-HxlkR_Is.js";import{A as J}from"./FeaturedImage-CkqylzIa.js";import{T as ze,a as Ee,b as Q,c,d as Me}from"./index-D0lLYbpS.js";import{w}from"./sweetalert2-react-content.es-SO4eO7oB.js";import{S as D}from"./sweetalert2.esm.all-BbQndx0i.js";import{d as _e}from"./template.service-DHJ4bMCZ.js";import"./index-DP5xIcvO.js";import"./media.service-DJZ01T9t.js";import"./MediaForm-owkpfofN.js";import"./index-DQmg3Or3.js";import"./index-DLnCA4SJ.js";import"./createLucideIcon-DTxeq6k1.js";const C="http://localhost:8080",Pe={country:null,city:"country",region:"city"};function Ae({selectedLocations:y,onRefresh:N}){const[g,r]=s.useState(null),[m,x]=s.useState(null),[k,E]=s.useState(!1),[M,_]=s.useState(0),[f,S]=s.useState(""),[T,v]=s.useState(""),[d,a]=s.useState(""),[l,h]=s.useState([]),[P,R]=s.useState(),[H,A]=s.useState(""),[te,ae]=s.useState([]),[se,oe]=s.useState([]),[u,O]=s.useState(),[p,F]=s.useState(),{closeModal:I,openModal:U}=G(!1),{setBlock:W}=Ce(),{adminTaxonomies:$}=V(),re={country:"countries",city:"cities",region:"regions"},{isOpen:ne,openModal:ie,closeModal:ce}=G(),le=[{key:"country",value:"country",label:"Country"},{key:"city",value:"city",label:"City"},{key:"region",value:"region",label:"Region"}],de=t=>{a(`${t}`)},me=t=>{R(Number(t))},xe=t=>{A(String(t))},ue=()=>{ie()};s.useEffect(()=>{(async()=>{try{const o=(await De()).data,b={key:0,value:0,label:"Select Timezone"},i=(o==null?void 0:o.map(L=>({key:L.id,value:L.timezone_name,label:L.timezone_name+" - ["+L.utc_offset+"]"})))??[];oe([b,...i]),ae(o)}catch(n){console.error(n)}})()},[]),s.useEffect(()=>{(async()=>{var n;try{const o=Pe[d],b=(n=$==null?void 0:$[re[o]])==null?void 0:n.map(i=>({key:i.id,value:i.id,label:i.name}));h(b??[])}catch(o){console.error("Failed to fetch parent locations:",o),h([])}})()},[d]),s.useEffect(()=>{if(y){const t=y;_(t.id??0),R(t.id_parent??0),S(t.name??""),a(t.typeLoc??""),v(t.slug??""),O({id:t.site_logo_id,url:`${C}/${t.site_logo}`}),F({id:t.flag_icon_id,url:`${C}/${t.flag_icon}`}),A(t.timezone??""),E(!0)}},[y]),Z(m,x),Z(g,r);const pe=()=>{S(""),v(""),A(""),O({url:"",id:void 0}),F({url:"",id:void 0})},he=async t=>{var o,b;t.preventDefault();const n={id_parent:P,name:f,slug:q(T),timezone:H,site_logo:u==null?void 0:u.id,flag_icon:p==null?void 0:p.id};try{if(k)await ve(M,d,n),x(f+" is Edited Successfully");else{if(!d){r("Please select type location");return}await fe(d,n),x(f+" is Created Successfully")}pe(),N()}catch(i){i instanceof Error&&r(i.message),typeof i=="object"&&i!==null&&"response"in i&&r(((b=(o=i.response)==null?void 0:o.data)==null?void 0:b.message)??"Something went wrong")}},ye=t=>{const n=t.target.value,o=k?T:q(n);S(t.target.value),v(o)},K=({label:t,children:n})=>e.jsxs("div",{className:"input-wrapper",children:[e.jsx(j,{children:t}),n]}),ge=t=>{O({url:`${C}/${t.path}`,id:t.id}),I(),W(!0)},je=t=>{F({url:`${C}/${t.path}`,id:t.id}),I(),W(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{title:"Form Locations",children:[e.jsx("div",{className:"mb-5",children:g&&e.jsx(X,{variant:"error",title:"Error",message:g})}),e.jsx("div",{className:"mb-5",children:m&&e.jsx(X,{variant:"success",title:"Success",message:m})}),e.jsxs("form",{onSubmit:he,children:[e.jsxs("div",{className:"space-y-3 space-x-6 grid grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Location Type"}),e.jsx(z,{options:le,value:d,placeholder:"Select Type Location",onChange:de,className:"dark:bg-dark-900"})]}),e.jsxs("div",{children:[e.jsx(j,{children:"Parent"}),e.jsx(z,{options:l??[],placeholder:"Select Parent",value:P,onChange:me,className:"dark:bg-dark-900"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(j,{htmlFor:"cName",children:"Name"}),e.jsx(Y,{type:"text",id:"cName",onChange:ye,value:f,placeholder:"Kuala Lumpur"})]}),d==="country"&&e.jsxs("div",{className:"mb-3",children:[e.jsxs(j,{children:[e.jsx("span",{className:"mr-2",children:"Time Zone"}),e.jsx(ke,{color:"info",onClick:ue,children:"?"})]}),e.jsx(z,{options:se,value:H,placeholder:"Select Timezone...",onChange:xe,className:"dark:bg-dark-900"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(j,{htmlFor:"cSlug",children:"Slug"}),e.jsx(Y,{type:"text",id:"cSlug",onChange:t=>v(t.target.value),value:T,placeholder:"kuala-lumpur"})]}),e.jsx("div",{className:"w-50 h-50",children:e.jsx(K,{label:"Site Logo",children:e.jsx(J,{url:u!=null&&u.url?`${u==null?void 0:u.url}`:"#",onClick:U,onSave:ge})})}),d==="country"&&e.jsx("div",{className:"w-50 h-50",children:e.jsx(K,{label:"Flag Icon",children:e.jsx(J,{url:p!=null&&p.url?`${p==null?void 0:p.url}`:"#",onClick:U,onSave:je})})}),e.jsx("div",{className:"space-y-6 space-x-6 flex justify-end",children:e.jsx(B,{startIcon:e.jsx(Le,{className:"size-5"}),className:"w-1/4",children:"Save"})})]})]}),e.jsx(we,{isOpen:ne,onCLose:ce,timezonesData:te})]})}function Oe({onEditLocation:y,onRefresh:N,refreshKey:g}){const[r,m]=s.useState(""),[x,k]=s.useState([]),{adminTaxonomies:E,generateUrlLocations:M}=V(),_={country:"countries",city:"cities",region:"regions"},f=[{key:"country",value:"country",label:"Country"},{key:"city",value:"city",label:"City"},{key:"region",value:"region",label:"Region"}],S=a=>{m(String(a))},T=async(a,l)=>{const h=await be(a,l);l===999?w(D).fire({title:"Oops",text:"This is a default location, you can't edit it",icon:"info"}):(y(h.data),window.scrollTo({top:0,behavior:"smooth"}))},v=async(a,l)=>{try{return await Ne(a,l),await _e(`/${M(a,l)}`),N(),!0}catch(h){return console.error(h),!1}},d=(a,l)=>{w(D).fire({title:`Are you sure to Delete ${a}?`,text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0}).then(async h=>{h.isConfirmed&&(await v(l,r)?w(D).fire({title:"Deleted!",text:"Tag has been deleted.",icon:"success"}):w(D).fire({title:"Warning",text:"Sorry, you can not delete this data",icon:"warning"}))})};return s.useEffect(()=>{(async()=>{r||m("country"),k(E[_[r]]??[])})()},[r,g]),e.jsx(e.Fragment,{children:e.jsxs(ee,{title:"Locations",children:[e.jsx("div",{className:"space-y-3 space-x-6 grid grid-cols-2",children:e.jsxs("div",{children:[e.jsx(j,{children:"Location Type"}),e.jsx(z,{options:f,placeholder:"Filter Location Type...",onChange:S,className:"dark:bg-dark-900"})]})}),e.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-white/[0.05] dark:bg-white/[0.03]",children:e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsxs(ze,{children:[e.jsx(Ee,{className:"border-b border-l-amber-800 dark:border-white/[0.05]",children:e.jsxs(Q,{children:[e.jsx(c,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400 max-w-[10px]",children:"#"}),e.jsx(c,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400 max-w-[10px]",children:"Name"}),e.jsx(c,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400",children:"Parent"}),e.jsx(c,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400",children:"Slug"}),e.jsx(c,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400",children:"Edit?"}),e.jsx(c,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400",children:"Delete"})]})}),e.jsx(Me,{className:"divide-y divide-gray-100 dark:divide-white/[0.05]",children:x==null?void 0:x.map((a,l)=>e.jsxs(Q,{children:[e.jsx(c,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:l+1}),e.jsx(c,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:a.name}),e.jsx(c,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:a.name_parent?a.name_parent:"-"}),e.jsx(c,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:a.slug?a.slug:"-"}),e.jsx(c,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:e.jsx(B,{onClick:()=>T(r,a.id),size:"sm",className:"bg-green-600 hover:bg-green-700",children:"Edit"})}),e.jsx(c,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:e.jsx(B,{onClick:()=>d(a.name,a.id),size:"sm",className:"bg-red-400 hover:bg-red-700",children:"Delete"})})]},a.id))})]})})})]})})}function dt(){const[y,N]=s.useState(),[g,r]=s.useState(0),m=()=>{r(x=>x+1)};return e.jsxs("div",{children:[e.jsx(Te,{title:"Whats New Asia Admin Dashboard | Master Locations",description:"This is Master Locations Dashboard page for Whats New Asia Admin Dashboard Template"}),e.jsx("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-1",children:e.jsxs("div",{className:"space-y-12",children:[e.jsx(Se,{pageTitle:"Locations"}),e.jsx(Ae,{selectedLocations:y,onRefresh:m}),e.jsx(Oe,{onEditLocation:N,refreshKey:g,onRefresh:m})]})})]})}export{dt as default};
